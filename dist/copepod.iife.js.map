{"version":3,"file":"copepod.iife.js","sources":["../lib/Copepod.js","../lib/CopepodCLient.js","../index.js"],"sourcesContent":["// build Proxy to handle set and delete on an object's properties\nconst buildProxy = (self) => {\n\treturn {\n\t\tset (target, property, value) {\n\t\t\tReflect.set(target, property, value)\n\t\t\tself.notify(property)\n\t\t\treturn true\n\t\t},\n\t\tdeleteProperty (target, property) {\n\t\t\tReflect.deleteProperty(target, property)\n\t\t\tself.notify(property)\n\t\t\treturn true\n\t\t}\n\t}\n}\n\nclass Copepod {\n\tconstructor (uid, obj, options = {}) {\n\t\tthis.uid = uid\n\n\t\tthis.subscribers = {} // watchers to notify on value change\n\n\t\tthis.obj = new Proxy(obj, buildProxy(this))\n\n\t\tthis.socket = null\n\n\t\tthis.options = options\n\t}\n\n\tdestroy () {\n\n\t}\n\n\tset (property, value) {\n\t\tif (this.obj[property] !== value) {\n\t\t\tthis.obj[property] = value\n\t\t}\n\t}\n\n\tdelete (property) {\n\t\tdelete this.obj[property]\n\t}\n\n\tsubscribe (id, fn) {\n\t\tthis.subscribers[id] = fn\n\t\tObject.keys(this.obj).forEach((k) => {\n\t\t\tfn(k, this.obj[k])\n\t\t})\n\t}\n\n\tunSubscribe (id) {\n\t\tif (this.subscribers[id]) {\n\t\t\tdelete this.subscribers[id]\n\t\t}\n\t}\n\n\tnotify (property) {\n\t\t// tell subscribers\n\t\tObject.keys(this.subscribers).forEach((k) => {\n\t\t\tthis.subscribers[k](property, this.obj[property])\n\t\t})\n\t}\n}\n\nexport {\n\tCopepod\n}\n","import {\n\tutils\n}\n\tfrom '@pelagiccreatures/sargasso'\n\nimport {\n\tCopepod\n}\n\tfrom './Copepod.js'\n\nclass CopepodClient extends Copepod {\n\tconstructor (uid, obj, options) {\n\t\tsuper(uid, obj, options)\n\n\t\tthis.inputs = {} // inputs to watch for value changes\n\n\t\t// establish client connection using socket.io\n\t\tif (options.namespace) {\n\t\t\tlet url = options.url || ''\n\t\t\tif (options.namespace) {\n\t\t\t\turl += options.namespace\n\t\t\t}\n\t\t\tthis.socket = io(url)\n\t\t\tthis.socket.on('authenticated', (user) => {\n\t\t\t\tthis.socket.on('change', (e) => {\n\t\t\t\t\tconsole.log('change from server: ', e)\n\t\t\t\t\tthis.set(e.property, e.value)\n\t\t\t\t})\n\t\t\t\tthis.socket.emit('subscribe', this.uid)\n\t\t\t})\n\t\t\tthis.socket.on('error', (err) => {\n\t\t\t\tconsole.log('got error:', err)\n\t\t\t})\n\t\t\tthis.socket.on('autherror', (err) => {\n\t\t\t\tconsole.log('got autherror:', err)\n\t\t\t})\n\n\t\t\tthis.socket.emit('authenticate')\n\t\t}\n\t}\n\n\tdestroy () {\n\t\t// cleanup event handlers\n\t\tObject.keys(this.inputs).forEach((k) => {\n\t\t\tutils.elementTools.off(this.constructor.name + '-' + this.uid, this.inputs[k], 'keyup change click')\n\t\t})\n\n\t\tsuper.destroy()\n\t}\n\n\tattachInput (input) {\n\t\tconst inputProp = input.getAttribute('name')\n\t\tif (!this.inputs[inputProp]) {\n\t\t\tthis.inputs[inputProp] = input\n\n\t\t\t// if input has a value, initialize this.obj[property] to input value\n\t\t\tif (input.value && input.value !== this.obj[inputProp]) {\n\t\t\t\tthis.obj[inputProp] = input.value\n\t\t\t} else {\n\t\t\t\tthis.obj[inputProp] = ''\n\t\t\t}\n\n\t\t\t// keep property in sync with input\n\t\t\tconst id = this.constructor.name + '-' + this.uid\n\t\t\tconst handler = (e) => {\n\t\t\t\tif (e.target.value !== this.obj[inputProp]) {\n\t\t\t\t\tthis.obj[inputProp] = e.target.value\n\t\t\t\t}\n\t\t\t}\n\t\t\tutils.elementTools.on(id, input, 'keyup change click', null, handler)\n\t\t}\n\t}\n\n\tdetatchInput (input) {\n\t\tconst inputProp = input.getAttribute('name')\n\t\tif (this.inputs[inputProp]) {\n\t\t\tconst id = this.constructor.name + '-' + this.uid\n\t\t\tutils.elementTools.off(id, input, 'keyup change click', null)\n\t\t\tdelete this.inputs[inputProp]\n\t\t}\n\t}\n\n\t// propagate change to server\n\tnotify (property) {\n\t\tsuper.notify(property)\n\n\t\t// sync inputs (input <- this.obj[property])\n\t\tObject.keys(this.inputs).forEach((k) => {\n\t\t\tthis.inputs[k].value = this.obj[k].toString()\n\t\t})\n\n\t\tif (this.socket) {\n\t\t\tthis.socket.emit('change', {\n\t\t\t\tproperty: property,\n\t\t\t\tvalue: this.obj[property]\n\t\t\t})\n\t\t}\n\t}\n}\n\nexport {\n\tCopepodClient\n}\n","/**\n\t@PelagicCreatures/Copepod\n\n\tSargasso class that impelments lazy loaded images using background-image which always\n\tfits image within its container's dimensions\n\n\t@author Michael Rhodes\n\t@license MIT\n\tMade in Barbados ðŸ‡§ðŸ‡§ Copyright Â© 2020 Michael Rhodes\n\n**/\n\nimport {\n\tCopepodClient\n}\n\tfrom './lib/CopepodCLient.js'\n\nexport {\n\tCopepodClient\n}\n"],"names":["utils"],"mappings":"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"}