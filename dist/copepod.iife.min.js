var CopepodModule=function(t,e){"use strict";var r,n="object"==typeof Reflect?Reflect:null,o=n&&"function"==typeof n.apply?n.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}var a=s,u=function(t,e){return new Promise((function(r,n){function o(){void 0!==i&&t.removeListener("error",i),r([].slice.call(arguments))}var i;"error"!==e&&(i=function(r){t.removeListener(e,o),n(r)},t.once("error",i)),t.once(e,o)}))};s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function l(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function f(t,e,r,n){var o,i,s,a;if(l(r),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),i=t._events),s=i[e]),void 0===s)s=i[e]=r,++t._eventsCount;else if("function"==typeof s?s=i[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=h(t))>0&&s.length>o&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return t}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function v(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},o=p.bind(n);return o.listener=r,n.wrapFn=o,o}function d(t,e,r){var n=t._events;if(void 0===n)return[];var o=n[e];return void 0===o?[]:"function"==typeof o?r?[o.listener||o]:[o]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(o):b(o,o.length)}function y(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function b(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=i[t];if(void 0===u)return!1;if("function"==typeof u)o(u,this,e);else{var c=u.length,l=b(u,c);for(r=0;r<c;++r)o(l[r],this,e)}return!0},s.prototype.addListener=function(t,e){return f(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return f(this,t,e,!0)},s.prototype.once=function(t,e){return l(e),this.on(t,v(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){return l(e),this.prependListener(t,v(this,t,e)),this},s.prototype.removeListener=function(t,e){var r,n,o,i,s;if(l(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===e||r[i].listener===e){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,o),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},s.prototype.listeners=function(t){return d(this,t,!0)},s.prototype.rawListeners=function(t){return d(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):y.call(t,e)},s.prototype.listenerCount=y,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]},a.once=u;var g=function(){this.__data__=[],this.size=0};var _=function(t,e){return t===e||t!=t&&e!=e};var m=function(t,e){for(var r=t.length;r--;)if(_(t[r][0],e))return r;return-1},j=Array.prototype.splice;var w=function(t){var e=this.__data__,r=m(e,t);return!(r<0)&&(r==e.length-1?e.pop():j.call(e,r,1),--this.size,!0)};var O=function(t){var e=this.__data__,r=m(e,t);return r<0?void 0:e[r][1]};var A=function(t){return m(this.__data__,t)>-1};var k=function(t,e){var r=this.__data__,n=m(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};function L(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}L.prototype.clear=g,L.prototype.delete=w,L.prototype.get=O,L.prototype.has=A,L.prototype.set=k;var x=L;var S=function(){this.__data__=new x,this.size=0};var E=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r};var T=function(t){return this.__data__.get(t)};var I=function(t){return this.__data__.has(t)},P="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function M(t){var e={exports:{}};return t(e,e.exports),e.exports}var z="object"==typeof P&&P&&P.Object===Object&&P,C="object"==typeof self&&self&&self.Object===Object&&self,N=z||C||Function("return this")(),F=N.Symbol,R=Object.prototype,$=R.hasOwnProperty,D=R.toString,q=F?F.toStringTag:void 0;var B=function(t){var e=$.call(t,q),r=t[q];try{t[q]=void 0;var n=!0}catch(t){}var o=D.call(t);return n&&(e?t[q]=r:delete t[q]),o},U=Object.prototype.toString;var W=function(t){return U.call(t)},H=F?F.toStringTag:void 0;var V=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":H&&H in Object(t)?B(t):W(t)};var K=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var G,J=function(t){if(!K(t))return!1;var e=V(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},Q=N["__core-js_shared__"],X=(G=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+G:"";var Y=function(t){return!!X&&X in t},Z=Function.prototype.toString;var tt=function(t){if(null!=t){try{return Z.call(t)}catch(t){}try{return t+""}catch(t){}}return""},et=/^\[object .+?Constructor\]$/,rt=Function.prototype,nt=Object.prototype,ot=rt.toString,it=nt.hasOwnProperty,st=RegExp("^"+ot.call(it).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var at=function(t){return!(!K(t)||Y(t))&&(J(t)?st:et).test(tt(t))};var ut=function(t,e){return null==t?void 0:t[e]};var ct=function(t,e){var r=ut(t,e);return at(r)?r:void 0},lt=ct(N,"Map"),ht=ct(Object,"create");var ft=function(){this.__data__=ht?ht(null):{},this.size=0};var pt=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},vt=Object.prototype.hasOwnProperty;var dt=function(t){var e=this.__data__;if(ht){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return vt.call(e,t)?e[t]:void 0},yt=Object.prototype.hasOwnProperty;var bt=function(t){var e=this.__data__;return ht?void 0!==e[t]:yt.call(e,t)};var gt=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=ht&&void 0===e?"__lodash_hash_undefined__":e,this};function _t(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}_t.prototype.clear=ft,_t.prototype.delete=pt,_t.prototype.get=dt,_t.prototype.has=bt,_t.prototype.set=gt;var mt=_t;var jt=function(){this.size=0,this.__data__={hash:new mt,map:new(lt||x),string:new mt}};var wt=function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var Ot=function(t,e){var r=t.__data__;return wt(e)?r["string"==typeof e?"string":"hash"]:r.map};var At=function(t){var e=Ot(this,t).delete(t);return this.size-=e?1:0,e};var kt=function(t){return Ot(this,t).get(t)};var Lt=function(t){return Ot(this,t).has(t)};var xt=function(t,e){var r=Ot(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};function St(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}St.prototype.clear=jt,St.prototype.delete=At,St.prototype.get=kt,St.prototype.has=Lt,St.prototype.set=xt;var Et=St;var Tt=function(t,e){var r=this.__data__;if(r instanceof x){var n=r.__data__;if(!lt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new Et(n)}return r.set(t,e),this.size=r.size,this};function It(t){var e=this.__data__=new x(t);this.size=e.size}It.prototype.clear=S,It.prototype.delete=E,It.prototype.get=T,It.prototype.has=I,It.prototype.set=Tt;var Pt=It;var Mt=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var zt=function(t){return this.__data__.has(t)};function Ct(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Et;++e<r;)this.add(t[e])}Ct.prototype.add=Ct.prototype.push=Mt,Ct.prototype.has=zt;var Nt=Ct;var Ft=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var Rt=function(t,e){return t.has(e)};var $t=function(t,e,r,n,o,i){var s=1&r,a=t.length,u=e.length;if(a!=u&&!(s&&u>a))return!1;var c=i.get(t),l=i.get(e);if(c&&l)return c==e&&l==t;var h=-1,f=!0,p=2&r?new Nt:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var v=t[h],d=e[h];if(n)var y=s?n(d,v,h,e,t,i):n(v,d,h,t,e,i);if(void 0!==y){if(y)continue;f=!1;break}if(p){if(!Ft(e,(function(t,e){if(!Rt(p,e)&&(v===t||o(v,t,r,n,i)))return p.push(e)}))){f=!1;break}}else if(v!==d&&!o(v,d,r,n,i)){f=!1;break}}return i.delete(t),i.delete(e),f},Dt=N.Uint8Array;var qt=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t,n){r[++e]=[n,t]})),r};var Bt=function(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r},Ut=F?F.prototype:void 0,Wt=Ut?Ut.valueOf:void 0;var Ht=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Dt(t),new Dt(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return _(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=qt;case"[object Set]":var u=1&n;if(a||(a=Bt),t.size!=e.size&&!u)return!1;var c=s.get(t);if(c)return c==e;n|=2,s.set(t,e);var l=$t(a(t),a(e),n,o,i,s);return s.delete(t),l;case"[object Symbol]":if(Wt)return Wt.call(t)==Wt.call(e)}return!1};var Vt=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Kt=Array.isArray;var Gt=function(t,e,r){var n=e(t);return Kt(t)?n:Vt(n,r(t))};var Jt=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};var Qt=function(){return[]},Xt=Object.prototype.propertyIsEnumerable,Yt=Object.getOwnPropertySymbols,Zt=Yt?function(t){return null==t?[]:(t=Object(t),Jt(Yt(t),(function(e){return Xt.call(t,e)})))}:Qt;var te=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var ee=function(t){return null!=t&&"object"==typeof t};var re=function(t){return ee(t)&&"[object Arguments]"==V(t)},ne=Object.prototype,oe=ne.hasOwnProperty,ie=ne.propertyIsEnumerable,se=re(function(){return arguments}())?re:function(t){return ee(t)&&oe.call(t,"callee")&&!ie.call(t,"callee")};var ae=function(){return!1},ue=M((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?N.Buffer:void 0,i=(o?o.isBuffer:void 0)||ae;t.exports=i})),ce=/^(?:0|[1-9]\d*)$/;var le=function(t,e){var r=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&ce.test(t))&&t>-1&&t%1==0&&t<e};var he=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},fe={};fe["[object Float32Array]"]=fe["[object Float64Array]"]=fe["[object Int8Array]"]=fe["[object Int16Array]"]=fe["[object Int32Array]"]=fe["[object Uint8Array]"]=fe["[object Uint8ClampedArray]"]=fe["[object Uint16Array]"]=fe["[object Uint32Array]"]=!0,fe["[object Arguments]"]=fe["[object Array]"]=fe["[object ArrayBuffer]"]=fe["[object Boolean]"]=fe["[object DataView]"]=fe["[object Date]"]=fe["[object Error]"]=fe["[object Function]"]=fe["[object Map]"]=fe["[object Number]"]=fe["[object Object]"]=fe["[object RegExp]"]=fe["[object Set]"]=fe["[object String]"]=fe["[object WeakMap]"]=!1;var pe=function(t){return ee(t)&&he(t.length)&&!!fe[V(t)]};var ve=function(t){return function(e){return t(e)}},de=M((function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&z.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i})),ye=de&&de.isTypedArray,be=ye?ve(ye):pe,ge=Object.prototype.hasOwnProperty;var _e=function(t,e){var r=Kt(t),n=!r&&se(t),o=!r&&!n&&ue(t),i=!r&&!n&&!o&&be(t),s=r||n||o||i,a=s?te(t.length,String):[],u=a.length;for(var c in t)!e&&!ge.call(t,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||le(c,u))||a.push(c);return a},me=Object.prototype;var je=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||me)};var we=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Oe=Object.prototype.hasOwnProperty;var Ae=function(t){if(!je(t))return we(t);var e=[];for(var r in Object(t))Oe.call(t,r)&&"constructor"!=r&&e.push(r);return e};var ke=function(t){return null!=t&&he(t.length)&&!J(t)};var Le=function(t){return ke(t)?_e(t):Ae(t)};var xe=function(t){return Gt(t,Le,Zt)},Se=Object.prototype.hasOwnProperty;var Ee=function(t,e,r,n,o,i){var s=1&r,a=xe(t),u=a.length;if(u!=xe(e).length&&!s)return!1;for(var c=u;c--;){var l=a[c];if(!(s?l in e:Se.call(e,l)))return!1}var h=i.get(t),f=i.get(e);if(h&&f)return h==e&&f==t;var p=!0;i.set(t,e),i.set(e,t);for(var v=s;++c<u;){var d=t[l=a[c]],y=e[l];if(n)var b=s?n(y,d,l,e,t,i):n(d,y,l,t,e,i);if(!(void 0===b?d===y||o(d,y,r,n,i):b)){p=!1;break}v||(v="constructor"==l)}if(p&&!v){var g=t.constructor,_=e.constructor;g==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof g&&g instanceof g&&"function"==typeof _&&_ instanceof _||(p=!1)}return i.delete(t),i.delete(e),p},Te=ct(N,"DataView"),Ie=ct(N,"Promise"),Pe=ct(N,"Set"),Me=ct(N,"WeakMap"),ze="[object Map]",Ce="[object Promise]",Ne="[object Set]",Fe="[object WeakMap]",Re="[object DataView]",$e=tt(Te),De=tt(lt),qe=tt(Ie),Be=tt(Pe),Ue=tt(Me),We=V;(Te&&We(new Te(new ArrayBuffer(1)))!=Re||lt&&We(new lt)!=ze||Ie&&We(Ie.resolve())!=Ce||Pe&&We(new Pe)!=Ne||Me&&We(new Me)!=Fe)&&(We=function(t){var e=V(t),r="[object Object]"==e?t.constructor:void 0,n=r?tt(r):"";if(n)switch(n){case $e:return Re;case De:return ze;case qe:return Ce;case Be:return Ne;case Ue:return Fe}return e});var He=We,Ve="[object Arguments]",Ke="[object Array]",Ge="[object Object]",Je=Object.prototype.hasOwnProperty;var Qe=function(t,e,r,n,o,i){var s=Kt(t),a=Kt(e),u=s?Ke:He(t),c=a?Ke:He(e),l=(u=u==Ve?Ge:u)==Ge,h=(c=c==Ve?Ge:c)==Ge,f=u==c;if(f&&ue(t)){if(!ue(e))return!1;s=!0,l=!1}if(f&&!l)return i||(i=new Pt),s||be(t)?$t(t,e,r,n,o,i):Ht(t,e,u,r,n,o,i);if(!(1&r)){var p=l&&Je.call(t,"__wrapped__"),v=h&&Je.call(e,"__wrapped__");if(p||v){var d=p?t.value():t,y=v?e.value():e;return i||(i=new Pt),o(d,y,r,n,i)}}return!!f&&(i||(i=new Pt),Ee(t,e,r,n,o,i))};var Xe=function t(e,r,n,o,i){return e===r||(null==e||null==r||!ee(e)&&!ee(r)?e!=e&&r!=r:Qe(e,r,n,o,t,i))};var Ye=function(t,e){return Xe(t,e)},Ze=function(){return N.Date.now()};var tr=function(t){return"symbol"==typeof t||ee(t)&&"[object Symbol]"==V(t)},er=/^\s+|\s+$/g,rr=/^[-+]0x[0-9a-f]+$/i,nr=/^0b[01]+$/i,or=/^0o[0-7]+$/i,ir=parseInt;var sr=function(t){if("number"==typeof t)return t;if(tr(t))return NaN;if(K(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=K(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(er,"");var r=nr.test(t);return r||or.test(t)?ir(t.slice(2),r?2:8):rr.test(t)?NaN:+t},ar=Math.max,ur=Math.min;const cr=Ye,lr=function(t,e,r){var n,o,i,s,a,u,c=0,l=!1,h=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var r=n,i=o;return n=o=void 0,c=e,s=t.apply(i,r)}function v(t){return c=t,a=setTimeout(y,e),l?p(t):s}function d(t){var r=t-u;return void 0===u||r>=e||r<0||h&&t-c>=i}function y(){var t=Ze();if(d(t))return b(t);a=setTimeout(y,function(t){var r=e-(t-u);return h?ur(r,i-(t-c)):r}(t))}function b(t){return a=void 0,f&&n?p(t):(n=o=void 0,s)}function g(){var t=Ze(),r=d(t);if(n=arguments,o=this,u=t,r){if(void 0===a)return v(u);if(h)return clearTimeout(a),a=setTimeout(y,e),p(u)}return void 0===a&&(a=setTimeout(y,e)),s}return e=sr(e)||0,K(r)&&(l=!!r.leading,i=(h="maxWait"in r)?ar(sr(r.maxWait)||0,e):i,f="trailing"in r?!!r.trailing:f),g.cancel=function(){void 0!==a&&clearTimeout(a),c=0,n=u=o=a=void 0},g.flush=function(){return void 0===a?s:b(Ze())},g},hr={};let fr=1;var pr={}.constructor;class vr extends a{constructor(t,e={},r={}){super(),this.id=t,this.uniqueId=fr++,this.bound={},this.data=new Proxy(e,(t=>({set(e,r,n){let o=t.getSource();return null!=n&&n.constructor===pr&&n._is_copepod_payload&&(o=n.source,n=n.value),Reflect.set(e,r,n),t.sync(r,o),!0}}))(this)),this.options=r,hr[this.id]=this}destroy(){delete this.data,delete hr[this.id],Object.keys(this.bound).forEach((t=>{Object.keys(this.bound[t]).forEach((e=>{this.unbind(t,e)}))}))}getBoundData(){return this.data}set(t,e,r){cr(this.get(t),e)||(this.data[t]={_is_copepod_payload:!0,source:r||this.getSource(),value:e})}get(t){return this.data[t]}delete(t){delete this.data[t]}getSource(){return this.constructor.name+":"+this.id}syncAll(){Object.keys(this.data||{}).forEach((t=>{this.sync(t)}))}bind(t,e,r="*"){this.bound[r]||(this.bound[r]={}),this.bound[r][t]=e,Object.keys(this.data).forEach((t=>{e(t,this.get(t))}))}unbind(t,e="*"){this.bound[e][t]&&delete this.bound[e][t]}sync(t,e){Object.keys(this.bound["*"]||{}).forEach((e=>{this.bound["*"][e](t,this.get(t))})),Object.keys(this.bound[t]||{}).forEach((e=>{this.bound[t][e](this.get(t))}))}}class dr extends e.Sargasso{constructor(t,e={}){e.watchDOM=!0,super(t,e)}DOMChanged(){!this.template&&this.element.innerHTML&&(e.services.theDOMWatcher.unSubscribe(this),this.template=this.element.innerHTML,this.element.innerHTML="",this.render())}start(){var t;super.start(),this.copepod=(t=this.element.getAttribute("data-copepod-id"),hr[t]),this.copepod.bind(this.uid,((t,e)=>{this.render()}))}sleep(){this.copepod.unbind(this.uid),delete this.copepod,super.sleep()}render(){this.template&&(this.element.innerHTML=this.template.replace(/\${(.*?)}/g,((t,e)=>this.copepod.get(e))))}}e.utils.registerSargassoClass("CopepodElement",dr);const yr=t=>{let e="";if(t.getAttribute("data-group")){const r=t.closest(".input-group").querySelectorAll(t.getAttribute("data-group")),n=[];for(let o=0;o<r.length;o++)yr(r[o])&&n.push(yr(r[o])),e=t.hasAttribute("multiple")?n:n.length?n[0]:""}else if("checkbox"===t.getAttribute("type")||"radio"===t.getAttribute("type"))t.checked&&(e=t.getAttribute("value"));else if("SELECT"===t.tagName){const r=t.querySelectorAll("option:checked"),n=Array.from(r).map((t=>t.value));e=t.hasAttribute("multiple")?Array.from(n):n[0]}else e="OPTION"===t.tagName?t.selected?t.getAttribute("value"):void 0:t.value;return e};return t.CopepodClient=class extends vr{constructor(t,e={},r){super(t,e,r),this.watchedInputs=[],this.boundInputs={},this.socket=null,this.pauseSocket=!1}start(){if(this.options.namespace){let t=this.options.url||"";this.options.namespace&&(t+=this.options.namespace),this.socket=io(t),this.socket.on("error",(t=>{this.emit("error",{message:"socket error",error:t})}));const e=t=>{if("ok"!==t.status)return void this.emit("error",{message:"copepod authentication failed",error:t});this.emit("status","authenticated");t.user;this.socket.on("disconnect",(t=>{this.emit("status","disconnect: "+t)})),this.socket.on("change",(t=>{this.set(t.property,t.value,t.source)}));const e={id:this.id,table:this.options.table,row:this.options.row};this.socket.emit("subscribe",e,(t=>{"ok"!==t.status&&this.emit("error",{message:"copepod authentication failed",error:t}),this.emit("status","subscribed")}))};this.socket.on("reconnect",(t=>{this.emit("status","reconnect attempt: "+t),this.socket.emit("authenticate",e)})),this.socket.emit("authenticate",e)}}destroy(){this.socket&&this.socket.disconnect(!0),this.watchedInputs.forEach((t=>{this.unbindInput(t)})),super.destroy()}bindForm(t){Array.from(t.querySelectorAll("input, select, textarea, button")).forEach((t=>{this.bindInput(t)})),this.syncAll()}bindInput(t){let r=t,n=t.getAttribute("name"),o=null;if(t.closest(".input-group")&&(o=t.closest(".input-group").querySelector("[data-group]"),o&&(r=o,n=o.getAttribute("name"))),this.boundInputs[n]||(this.boundInputs[n]=r),-1===this.watchedInputs.indexOf(t)){this.watchedInputs.push(t);const o=lr((t=>{const e=yr(r);this.set(n,e)}),500),i=this.constructor.name+"-"+this.id;e.utils.elementTools.on(i,t,"keyup change click blur",null,o)}}unbindInput(t){this.watchedInputs.splice(this.watchedInputs.indexOf(t),1);const r=this.constructor.name+"-"+this.id;e.utils.elementTools.off(r,t,"keyup change click blur",null)}getSource(){return super.getSource()+":"+this.socket.id}sync(t,e){super.sync(t,e),this.boundInputs[t]&&((t,e)=>{if(t.getAttribute("data-group")){e||(e=[]);const r=t.closest(".input-group").querySelectorAll(t.getAttribute("data-group"));for(let t=0;t<r.length;t++){const n=r[t];if("radio"===n.getAttribute("type"))e==n.value&&(n.checked=!0);else{let t=-1;for(let r=0;r<e.length;r++)if(e[r]==n.value){t=r;break}-1!==t?"checkbox"===n.getAttribute("type")?n.checked=!0:"OPTION"===n.tagName&&(n.selected=!0):"checkbox"===n.getAttribute("type")?n.checked=!1:"OPTION"===n.tagName&&(n.selected=!1)}}}else"checkbox"===t.getAttribute("type")?t.checked=e==t.value:t.value=e})(this.boundInputs[t],this.get(t)),this.socket&&e===this.getSource()&&this.socket.emit("change",{source:this.socket.id,property:t,value:this.get(t)})}},Object.defineProperty(t,"__esModule",{value:!0}),t}({},SargassoModule);
//# sourceMappingURL=copepod.iife.min.js.map
